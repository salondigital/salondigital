exec("import re;import base64");exec(base64.b64decode("aW1wb3J0IHhibWMsIHhibWNhZGRvbiwgeGJtY2d1aSwgeGJtY3BsdWdpbiwgb3MsIHN5cywgeGJtY3ZmcywgZ2xvYgppbXBvcnQgc2h1dGlsCmltcG9ydCB1cmxsaWIyLHVybGxpYgppbXBvcnQgcmUKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZSwgZGF0ZXRpbWUsIHRpbWVkZWx0YQpmcm9tIHJlc291cmNlcy5saWJzIGltcG9ydCBleHRyYWN0LCBkb3dubG9hZGVyLCBub3RpZnksIGxvZ2luaXQsIGRlYnJpZGl0LCB0cmFrdGl0LCBza2luU3dpdGNoLCB1cGxvYWRMb2csIHdpemFyZCBhcyB3aXoKCkFERE9OX0lEICAgICAgID0geGJtY2FkZG9uLkFkZG9uKCkuZ2V0QWRkb25JbmZvKCdpZCcpCkFERE9OVElUTEUgICAgID0gJ1NhbG9uRGlnaXRhbCcKQlVJTERGSUxFICAgICAgPSAnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3BlZHJvanVhbmFtZWxpZS91bml2ZXJzaWRhZHBhbC9tYXN0ZXIvbWZoZzIudHh0JwpBRERPTiAgICAgICAgICA9IHdpei5hZGRvbklkKEFERE9OX0lEKQpWRVJTSU9OICAgICAgICA9IHdpei5hZGRvbkluZm8oQURET05fSUQsJ3ZlcnNpb24nKQpBRERPTlBBVEggICAgICA9IHdpei5hZGRvbkluZm8oQURET05fSUQsJ3BhdGgnKQpBRERPTklEICAgICAgICA9IHdpei5hZGRvbkluZm8oQURET05fSUQsJ2lkJykKRElBTE9HICAgICAgICAgPSB4Ym1jZ3VpLkRpYWxvZygpCkRQICAgICAgICAgICAgID0geGJtY2d1aS5EaWFsb2dQcm9ncmVzcygpCkhPTUUgICAgICAgICAgID0geGJtYy50cmFuc2xhdGVQYXRoKCdzcGVjaWFsOi8vaG9tZS8nKQpQUk9GSUxFICAgICAgICA9IHhibWMudHJhbnNsYXRlUGF0aCgnc3BlY2lhbDovL3Byb2ZpbGUvJykKS09ESUhPTUUgICAgICAgPSB4Ym1jLnRyYW5zbGF0ZVBhdGgoJ3NwZWNpYWw6Ly94Ym1jLycpCkFERE9OUyAgICAgICAgID0gb3MucGF0aC5qb2luKEhPTUUsICAgICAnYWRkb25zJykKS09ESUFERE9OUyAgICAgPSBvcy5wYXRoLmpvaW4oS09ESUhPTUUsICdhZGRvbnMnKQpVU0VSREFUQSAgICAgICA9IG9zLnBhdGguam9pbihIT01FLCAgICAgJ3VzZXJkYXRhJykKUExVR0lOICAgICAgICAgPSBvcy5wYXRoLmpvaW4oQURET05TLCAgIEFERE9OX0lEKQpQQUNLQUdFUyAgICAgICA9IG9zLnBhdGguam9pbihBRERPTlMsICAgJ3BhY2thZ2VzJykKQURET05EQVRBICAgICAgPSBvcy5wYXRoLmpvaW4oVVNFUkRBVEEsICdhZGRvbl9kYXRhJywgQURET05fSUQpCkZBTkFSVCAgICAgICAgID0gb3MucGF0aC5qb2luKEFERE9OUEFUSCwnZmFuYXJ0LmpwZycpCklDT04gICAgICAgICAgID0gb3MucGF0aC5qb2luKEFERE9OUEFUSCwnaWNvbi5wbmcnKQpBUlQgICAgICAgICAgICA9IG9zLnBhdGguam9pbihBRERPTlBBVEgsJ3Jlc291cmNlcycsICdhcnQnKQpTS0lOICAgICAgICAgICA9IHhibWMuZ2V0U2tpbkRpcigpCkJVSUxETkFNRSAgICAgID0gd2l6LmdldFMoJ2J1aWxkbmFtZScpCkRFRkFVTFRTS0lOICAgID0gd2l6LmdldFMoJ2RlZmF1bHRza2luJykKREVGQVVMVE5BTUUgICAgPSB3aXouZ2V0UygnZGVmYXVsdHNraW5uYW1lJykKREVGQVVMVElHTk9SRSAgPSB3aXouZ2V0UygnZGVmYXVsdHNraW5pZ25vcmUnKQpCVUlMRFZFUlNJT04gICA9IHdpei5nZXRTKCdidWlsZHZlcnNpb24nKQpCVUlMRExBVEVTVCAgICA9IHdpei5nZXRTKCdsYXRlc3R2ZXJzaW9uJykKQlVJTERDSEVDSyAgICAgPSB3aXouZ2V0UygnbGFzdGJ1aWxkY2hlY2snKQpESVNBQkxFVVBEQVRFICA9IHdpei5nZXRTKCdkaXNhYmxldXBkYXRlJykKQVVUT0NMRUFOVVAgICAgPSB3aXouZ2V0UygnYXV0b2NsZWFuJykKQVVUT0NBQ0hFICAgICAgPSB3aXouZ2V0UygnY2xlYXJjYWNoZScpCkFVVE9QQUNLQUdFUyAgID0gd2l6LmdldFMoJ2NsZWFycGFja2FnZXMnKQpBVVRPVEhVTUJTICAgICA9IHdpei5nZXRTKCdjbGVhcnRodW1icycpCkFVVE9GRVEgICAgICAgID0gd2l6LmdldFMoJ2F1dG9jbGVhbmZlcScpCkFVVE9ORVhUUlVOICAgID0gd2l6LmdldFMoJ25leHRhdXRvY2xlYW51cCcpClRSQUtUU0FWRSAgICAgID0gd2l6LmdldFMoJ3RyYWt0bGFzdHNhdmUnKQpSRUFMU0FWRSAgICAgICA9IHdpei5nZXRTKCdkZWJyaWRsYXN0c2F2ZScpCkxPR0lOU0FWRSAgICAgID0gd2l6LmdldFMoJ2xvZ2lubGFzdHNhdmUnKQpLRUVQVFJBS1QgICAgICA9IHdpei5nZXRTKCdrZWVwdHJha3QnKQpLRUVQUkVBTCAgICAgICA9IHdpei5nZXRTKCdrZWVwZGVicmlkJykKS0VFUExPR0lOICAgICAgPSB3aXouZ2V0Uygna2VlcGxvZ2luJykKSU5TVEFMTEVEICAgICAgPSB3aXouZ2V0UygnaW5zdGFsbGVkJykKRVhUUkFDVCAgICAgICAgPSB3aXouZ2V0UygnZXh0cmFjdCcpCkVYVEVSUk9SICAgICAgID0gd2l6LmdldFMoJ2Vycm9ycycpCk5PVElGWSAgICAgICAgID0gd2l6LmdldFMoJ25vdGlmeScpCk5PVEVESVNNSVNTICAgID0gd2l6LmdldFMoJ25vdGVkaXNtaXNzJykKTk9URUlEICAgICAgICAgPSB3aXouZ2V0Uygnbm90ZWlkJykKQkFDS1VQTE9DQVRJT04gPSBBRERPTi5nZXRTZXR0aW5nKCdwYXRoJykgaWYgbm90IEFERE9OLmdldFNldHRpbmcoJ3BhdGgnKSA9PSAnJyBlbHNlIEhPTUUKTVlCVUlMRFMgICAgICAgPSBvcy5wYXRoLmpvaW4oQkFDS1VQTE9DQVRJT04sICdTYWxvbkRpZ2l0YWxfQmFja3VwJywgJycpCk5PVEVJRCAgICAgICAgID0gMCBpZiBOT1RFSUQgPT0gIiIgZWxzZSBpbnQoTk9URUlEKQpBVVRPRkVRICAgICAgICA9IGludChBVVRPRkVRKSBpZiBBVVRPRkVRLmlzZGlnaXQoKSBlbHNlIDAKVE9EQVkgICAgICAgICAgPSBkYXRlLnRvZGF5KCkKVE9NT1JST1cgICAgICAgPSBUT0RBWSArIHRpbWVkZWx0YShkYXlzPTEpClRXT0RBWVMgICAgICAgID0gVE9EQVkgKyB0aW1lZGVsdGEoZGF5cz0yKQpUSFJFRURBWVMgICAgICA9IFRPREFZICsgdGltZWRlbHRhKGRheXM9MykKT05FV0VFSyAgICAgICAgPSBUT0RBWSArIHRpbWVkZWx0YShkYXlzPTcpCktPRElWICAgICAgICAgID0gZmxvYXQoeGJtYy5nZXRJbmZvTGFiZWwoIlN5c3RlbS5CdWlsZFZlcnNpb24iKVs6NF0pCkVYQ0xVREVTICAgICAgID0gW0FERE9OX0lEICwgJ3JlcG9zaXRvcnkuc2Fsb25kaWdpdGFsJ10KVVBEQVRFQ0hFQ0sgICAgPSAwCk5FWFRDSEVDSyAgICAgID0gVE9EQVkgKyB0aW1lZGVsdGEoZGF5cz1VUERBVEVDSEVDSykKTk9USUZJQ0FUSU9OICAgPSAnaHR0cDovLycKRU5BQkxFICAgICAgICAgPSAnTm8nCkhFQURFUk1FU1NBR0UgICAgPSAnU2Fsb25EaWdpdGFsIFVwZGF0ZXIuLi4uLicKQVVUT1VQREFURSAgICAgPSAnTm8nCldJWkFSREZJTEUgICAgID0gJ2h0dHBzOi8vc2Fsb25kaWdpdGFsLmVzL3dpemFyZC5waHAnCkFVVE9JTlNUQUxMICAgID0gJ1llcycKUkVQT0lEICAgICAgICAgPSAncmVwb3NpdG9yeS5zYWxvbmRpZ2l0YWwnClJFUE9BRERPTlhNTCAgID0gJ2h0dHBzOi8vZ2l0aHViLmNvbS9zYWxvbmRpZ2l0YWwvc2Fsb25kaWdpdGFsL3Jhdy9tYXN0ZXIvcmVwb3NpdG9yeS5zYWxvbmRpZ2l0YWwvYWRkb24ueG1sJwpSRVBPWklQVVJMICAgICA9ICdodHRwczovL2dpdGh1Yi5jb20vc2Fsb25kaWdpdGFsL3NhbG9uZGlnaXRhbC9yYXcvbWFzdGVyLycKQ09MT1IxICAgICAgICAgPSAnb3JhbmdlJwpDT0xPUjIgICAgICAgICA9ICd3aGl0ZScKV09SS0lORyAgICAgICAgPSBUcnVlIGlmIHdpei53b3JraW5nVVJMKEJVSUxERklMRSkgPT0gVHJ1ZSBlbHNlIEZhbHNlCkZBSUxFRCAgICAgICAgID0gRmFsc2UKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIyMjIENvbXByb2JhciBhY3R1YWxpemFjaW9uZXMgICAjIyMjIyMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCmRlZiBjaGVja1VwZGF0ZSgpOgogICAgQlVJTEROQU1FICAgICAgPSB3aXouZ2V0UygnYnVpbGRuYW1lJykKICAgIEJVSUxEVkVSU0lPTiAgID0gd2l6LmdldFMoJ2J1aWxkdmVyc2lvbicpCiAgICBsaW5rICAgICAgICAgICA9IHdpei5vcGVuVVJMKEJVSUxERklMRSkucmVwbGFjZSgnXG4nLCcnKS5yZXBsYWNlKCdccicsJycpLnJlcGxhY2UoJ1x0JywnJykKICAgIG1hdGNoICAgICAgICAgID0gcmUuY29tcGlsZSgnbmFtZT0iJXMiLis/ZXJzaW9uPSIoLis/KSIuKz9jb249IiguKz8pIi4rP2FuYXJ0PSIoLis/KSInICUgQlVJTEROQU1FKS5maW5kYWxsKGxpbmspCiAgICBpZiBsZW4obWF0Y2gpID4gMDoKICAgICAgICB2ZXJzaW9uID0gbWF0Y2hbMF1bMF0KICAgICAgICBpY29uICAgID0gbWF0Y2hbMF1bMV0KICAgICAgICBmYW5hcnQgID0gbWF0Y2hbMF1bMl0KICAgICAgICB3aXouc2V0UygnbGF0ZXN0dmVyc2lvbicsIHZlcnNpb24pCiAgICAgICAgaWYgdmVyc2lvbiA+IEJVSUxEVkVSU0lPTjoKICAgICAgICAgICAgaWYgRElTQUJMRVVQREFURSA9PSAnZmFsc2UnOgogICAgICAgICAgICAgICAgd2l6LmxvZygiW0NvbXByb2JhciBhY3R1YWxpemFjaW9uZXNdIFtWZXJzaW9uIGluc3RhbGFkYTogJXNdIFtWZXJzaW9uIG1hcyBhY3R1YWw6ICVzXSBBYnJpZW5kbyB2ZW50YW5hIGRlIGFjdHVhbGl6YWNpb24iICUgKEJVSUxEVkVSU0lPTiwgdmVyc2lvbiksIHhibWMuTE9HTk9USUNFKQogICAgICAgICAgICAgICAgbm90aWZ5LnVwZGF0ZVdpbmRvdyhCVUlMRE5BTUUsIEJVSUxEVkVSU0lPTiwgdmVyc2lvbiwgaWNvbiwgZmFuYXJ0KQogICAgICAgICAgICBlbHNlOiB3aXoubG9nKCJbQ29tcHJvYmFyIGFjdHVhbGl6YWNpb25lc10gW1ZlcnNpb24gaW5zdGFsYWRhOiAlc10gW1ZlcnNpb24gbWFzIGFjdHVhbDogJXNdIFZlbnRhbmEgZGUgYWN0dWFsaXphY2lvbiBkZXNhY3RpdmFkYSIgJSAoQlVJTERWRVJTSU9OLCB2ZXJzaW9uKSwgeGJtYy5MT0dOT1RJQ0UpCiAgICAgICAgZWxzZTogd2l6LmxvZygiW0NvbXByb2JhciBhY3R1YWxpemFjaW9uZXNdIFtWZXJzaW9uIGluc3RhbGFkYTogJXNdIFtWZXJzaW9uIG1hcyBhY3R1YWw6ICVzXSIgJSAoQlVJTERWRVJTSU9OLCB2ZXJzaW9uKSwgeGJtYy5MT0dOT1RJQ0UpCiAgICBlbHNlOiB3aXoubG9nKCJbQ29tcHJvYmFyIGFjdHVhbGl6YWNpb25lc10gRVJST1I6IEltcG9zaWJsZSBlbmNvbnRyYXIgYWN0dWFsaXphY2lvbmVzIGVsIGFyY2hpdm8gdHh0IGRlIFNhbG9uRGlnaXRhbCIsIHhibWMuTE9HRVJST1IpCgpkZWYgY2hlY2tTa2luKCk6CiAgICB3aXoubG9nKCJbQ29tcHJvYmFjaW9uIGRlIGFjdHVhbGl6YWNpb25dIEZhbGxvIGVuIGNvbXByb2JhY2lvbiBpbmljaWFsIGRlIHNraW4iKQogICAgREVGQVVMVFNLSU4gICA9IHdpei5nZXRTKCdkZWZhdWx0c2tpbicpCiAgICBERUZBVUxUTkFNRSAgID0gd2l6LmdldFMoJ2RlZmF1bHRza2lubmFtZScpCiAgICBERUZBVUxUSUdOT1JFID0gd2l6LmdldFMoJ2RlZmF1bHRza2luaWdub3JlJykKICAgIGdvdG9za2luID0gRmFsc2UKICAgIGlmIG5vdCBERUZBVUxUU0tJTiA9PSAnJzoKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhvcy5wYXRoLmpvaW4oQURET05TLCBERUZBVUxUU0tJTikpOgogICAgICAgICAgICBpZiBESUFMT0cueWVzbm8oQURET05USVRMRSwgIltDT0xPUiAlc11QYXJlY2UgcXVlIEtvZGkgaGEgdnVlbHRvIGEgcG9uZXIgbGEgc2tpbiBwcmVkZXRlcm1pbmFkYSBwb3IgZGVmZWN0byBsbGFtYWRhIFtDT0xPUiAlc10lc1svQ09MT1JdIiAlIChDT0xPUjIsIENPTE9SMSwgU0tJTls1Ol0udGl0bGUoKSksICJRdWllcmVzIHZvbHZlciBhIHBvbmVyIGxhIHNraW4gcG9yIGRlZmVjdG8gZGUgU2Fsb25EaWdpdGFsP1svQ09MT1JdIiwgJyhbQ09MT1IgJXNdJXNbL0NPTE9SXSknICUgKENPTE9SMSwgREVGQVVMVE5BTUUpKToKICAgICAgICAgICAgICAgIGdvdG9za2luID0gREVGQVVMVFNLSU4KICAgICAgICAgICAgICAgIGdvdG9uYW1lID0gREVGQVVMVE5BTUUKICAgICAgICAgICAgZWxzZTogd2l6LmxvZygiTGEgc2tpbiBubyBzZSBoYSByZXNldGVhZG8iLCB4Ym1jLkxPR05PVElDRSk7IHdpei5zZXRTKCdkZWZhdWx0c2tpbmlnbm9yZScsICd0cnVlJyk7IGdvdG9za2luID0gRmFsc2UKICAgICAgICBlbHNlOiB3aXouc2V0UygnZGVmYXVsdHNraW4nLCAnJyk7IHdpei5zZXRTKCdkZWZhdWx0c2tpbm5hbWUnLCAnJyk7IERFRkFVTFRTS0lOID0gJyc7IERFRkFVTFROQU1FID0gJycKICAgIGlmIERFRkFVTFRTS0lOID09ICcnOgogICAgICAgIHNraW5uYW1lID0gW10KICAgICAgICBza2lubGlzdCA9IFtdCiAgICAgICAgZm9yIGZvbGRlciBpbiBnbG9iLmdsb2Iob3MucGF0aC5qb2luKEFERE9OUywgJ3NraW4uKi8nKSk6CiAgICAgICAgICAgIHhtbCA9ICIlcy9hZGRvbi54bWwiICUgZm9sZGVyCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHhtbCk6CiAgICAgICAgICAgICAgICBmICA9IG9wZW4oeG1sLG1vZGU9J3InKTsgZyA9IGYucmVhZCgpLnJlcGxhY2UoJ1xuJywnJykucmVwbGFjZSgnXHInLCcnKS5yZXBsYWNlKCdcdCcsJycpOyBmLmNsb3NlKCk7CiAgICAgICAgICAgICAgICBtYXRjaCAgPSB3aXoucGFyc2VET00oZywgJ2FkZG9uJywgcmV0PSdpZCcpCiAgICAgICAgICAgICAgICBtYXRjaDIgPSB3aXoucGFyc2VET00oZywgJ2FkZG9uJywgcmV0PSduYW1lJykKICAgICAgICAgICAgICAgIHdpei5sb2coIiVzOiAlcyIgJSAoZm9sZGVyLCBzdHIobWF0Y2hbMF0pKSwgeGJtYy5MT0dOT1RJQ0UpCiAgICAgICAgICAgICAgICBpZiBsZW4obWF0Y2gpID4gMDogc2tpbmxpc3QuYXBwZW5kKHN0cihtYXRjaFswXSkpOyBza2lubmFtZS5hcHBlbmQoc3RyKG1hdGNoMlswXSkpCiAgICAgICAgICAgICAgICBlbHNlOiB3aXoubG9nKCJJRCBubyBlbmNvbnRyYWRhIHBhcmEgJXMiICUgZm9sZGVyLCB4Ym1jLkxPR05PVElDRSkKICAgICAgICAgICAgZWxzZTogd2l6LmxvZygiSUQgbm8gZW5jb250cmFkYSBwYXJhICVzIiAlIGZvbGRlciwgeGJtYy5MT0dOT1RJQ0UpCiAgICAgICAgaWYgbGVuKHNraW5saXN0KSA+IDA6CiAgICAgICAgICAgIGlmIGxlbihza2lubGlzdCkgPiAxOgogICAgICAgICAgICAgICAgaWYgRElBTE9HLnllc25vKEFERE9OVElUTEUsICJbQ09MT1IgJXNdUGFyZWNlIHF1ZSBLb2RpIGhhIHZ1ZWx0byBhIHBvbmVyIGxhIHNraW4gcHJlZGV0ZXJtaW5hZGEgcG9yIGRlZmVjdG8gbGxhbWFkYSBbQ09MT1IgJXNdJXNbL0NPTE9SXSIgJSAoQ09MT1IyLCBDT0xPUjEsIFNLSU5bNTpdLnRpdGxlKCkpLCAiUXVpZXJlcyB2ZXIgbGEgbGlzdGEgZGUgc2tpbnMgaW5zdGFsYWRhcyBlbiBLb2RpP1svQ09MT1JdIik6CiAgICAgICAgICAgICAgICAgICAgY2hvaWNlID0gRElBTE9HLnNlbGVjdCgiU2VsZWNjaW9uYSB1bmEgc2tpbiBwYXJhIGFwbGljYXIgbG9zIGNhbWJpb3MhIiwgc2tpbm5hbWUpCiAgICAgICAgICAgICAgICAgICAgaWYgY2hvaWNlID09IC0xOiB3aXoubG9nKCJMYSBza2luIG5vIHNlIGhhIHJlc2V0ZWFkbyIsIHhibWMuTE9HTk9USUNFKTsgd2l6LnNldFMoJ2RlZmF1bHRza2luaWdub3JlJywgJ3RydWUnKQogICAgICAgICAgICAgICAgICAgIGVsc2U6IAogICAgICAgICAgICAgICAgICAgICAgICBnb3Rvc2tpbiA9IHNraW5saXN0W2Nob2ljZV0KICAgICAgICAgICAgICAgICAgICAgICAgZ290b25hbWUgPSBza2lubmFtZVtjaG9pY2VdCiAgICAgICAgICAgICAgICBlbHNlOiB3aXoubG9nKCJMYSBza2luIG5vIHNlIGhhIHJlc2V0ZWFkbyIsIHhibWMuTE9HTk9USUNFKTsgd2l6LnNldFMoJ2RlZmF1bHRza2luaWdub3JlJywgJ3RydWUnKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgRElBTE9HLnllc25vKEFERE9OVElUTEUsICJbQ09MT1IgJXNdUGFyZWNlIHF1ZSBLb2RpIGhhIHZ1ZWx0byBhIHBvbmVyIGxhIHNraW4gcHJlZGV0ZXJtaW5hZGEgcG9yIGRlZmVjdG8gbGxhbWFkYSBbQ09MT1IgJXNdJXNbL0NPTE9SXSIgJSAoQ09MT1IyLCBDT0xPUjEsIFNLSU5bNTpdLnRpdGxlKCkpLCAiUXVpZXJlcyB2b2x2ZXIgYSBwb25lciBsYSBza2luIHBvciBkZWZlY3RvIGRlIFNhbG9uRGlnaXRhbD9bL0NPTE9SXSIsICcoW0NPTE9SICVzXSVzWy9DT0xPUl0pJyAlIChDT0xPUjEsIHNraW5uYW1lWzBdKSk6CiAgICAgICAgICAgICAgICAgICAgZ290b3NraW4gPSBza2lubGlzdFswXQogICAgICAgICAgICAgICAgICAgIGdvdG9uYW1lID0gc2tpbm5hbWVbMF0KICAgICAgICAgICAgICAgIGVsc2U6IHdpei5sb2coIkxhIHNraW4gbm8gc2UgaGEgcmVzZXRlYWRvIiwgeGJtYy5MT0dOT1RJQ0UpOyB3aXouc2V0UygnZGVmYXVsdHNraW5pZ25vcmUnLCAndHJ1ZScpCiAgICAgICAgZWxzZTogd2l6LmxvZygiTm8gc2UgaGFuIGVuY29udHJhZG8gc2tpbnMgZW4gbGEgaW5zdGFsYWNpb24uIiwgeGJtYy5MT0dOT1RJQ0UpOyB3aXouc2V0UygnZGVmYXVsdHNraW5pZ25vcmUnLCAndHJ1ZScpOyBnb3Rvc2tpbiA9IEZhbHNlCiAgICBpZiBnb3Rvc2tpbjoKICAgICAgICBza2luU3dpdGNoLnN3YXBTa2lucyhnb3Rvc2tpbikKICAgICAgICB4ID0gMAogICAgICAgIHhibWMuc2xlZXAoMTAwMCkKICAgICAgICB3aGlsZSBub3QgeGJtYy5nZXRDb25kVmlzaWJpbGl0eSgiV2luZG93LmlzVmlzaWJsZSh5ZXNub2RpYWxvZykiKSBhbmQgeCA8IDE1MDoKICAgICAgICAgICAgeCArPSAxCiAgICAgICAgICAgIHhibWMuc2xlZXAoMjAwKQoKICAgICAgICBpZiB4Ym1jLmdldENvbmRWaXNpYmlsaXR5KCJXaW5kb3cuaXNWaXNpYmxlKHllc25vZGlhbG9nKSIpOgogICAgICAgICAgICB3aXouZWJpKCdTZW5kQ2xpY2soMTEpJykKICAgICAgICAgICAgd2l6Lmxvb2thbmRGZWVsRGF0YSgncmVzdG9yZScpCiAgICAgICAgZWxzZTogd2l6LkxvZ05vdGlmeSgiW0NPTE9SICVzXSVzWy9DT0xPUl0iICUgKENPTE9SMSwgQURET05USVRMRSksJ1tDT0xPUiAlc11TZSBoYSBhZ290YWRvIGVsIHRpZW1wbyBwYXJhIGNhbWJhaXIgbGEgc2tpbiFbL0NPTE9SXScgJSBDT0xPUjIpCiAgICB3aXoubG9nKCJbQ29tcHJvYmFjaW9uIGRlIGFjdHVhbGl6YWNpb25dIEZhbGxvIGVuIGNvbXByb2JhY2lvbiBmaW5hbCBkZSBza2luIiwgeGJtYy5MT0dOT1RJQ0UpCgp3aGlsZSB4Ym1jLlBsYXllcigpLmlzUGxheWluZ1ZpZGVvKCk6CiAgICB4Ym1jLnNsZWVwKDEwMDApCgppZiBLT0RJViA+PSAxNzoKICAgIE5PVyA9IGRhdGV0aW1lLm5vdygpCiAgICB0ZW1wID0gd2l6LmdldFMoJ2tvZGkxN2lzY3JhcCcpCiAgICBpZiBub3QgdGVtcCA9PSAnJzoKICAgICAgICBpZiB0ZW1wID4gc3RyKE5PVyAtIHRpbWVkZWx0YShtaW51dGVzPTIpKToKICAgICAgICAgICAgd2l6LmxvZygiTWF0YW5kbyBlbCBzY3JpcHQgZGUgaW5pY2lvIGRlIEtvZGkiKQogICAgICAgICAgICBzeXMuZXhpdCgpCiAgICB3aXoubG9nKCIlcyIgJSAoTk9XKSkKICAgIHdpei5zZXRTKCdrb2RpMTdpc2NyYXAnLCBzdHIoTk9XKSkKICAgIHhibWMuc2xlZXAoMTAwMCkKICAgIGlmIG5vdCB3aXouZ2V0Uygna29kaTE3aXNjcmFwJykgPT0gc3RyKE5PVyk6CiAgICAgICAgd2l6LmxvZygiTWF0YW5kbyBlbCBzY3JpcHQgZGUgaW5pY2lvIGRlIEtvZGkiKQogICAgICAgIHN5cy5leGl0KCkKICAgIGVsc2U6CiAgICAgICAgd2l6LmxvZygiQ29udGludWEgZWwgc2NyaXB0IGRlIGluaWNpbyBkZSBLb2RpIikKCndpei5sb2coIltDb21wcm9iYWNpb24gZGUgcnV0YV0gSW5pY2lhZGEiLCB4Ym1jLkxPR05PVElDRSkKcGF0aCA9IG9zLnBhdGguc3BsaXQoQURET05QQVRIKQppZiBub3QgQURET05JRCA9PSBwYXRoWzFdOiBESUFMT0cub2soQURET05USVRMRSwgJ1tDT0xPUiAlc11Qb3IgZmF2b3IsIGFzZWd1cmF0ZSBkZSBxdWUgbGEgY2FycGV0YSBkZWwgYWRkb24gZXMgbGEgbWlzbWEgcXVlIGVsIEFERE9OX0lELlsvQ09MT1JdJyAlIENPTE9SMiwgJ1tDT0xPUiAlc11QbHVnaW4gSUQ6Wy9DT0xPUl0gW0NPTE9SICVzXSVzWy9DT0xPUl0nICUgKENPTE9SMiwgQ09MT1IxLCBBRERPTklEKSwgJ1tDT0xPUiAlc11DYXJwZXRhIGRlbCBwbHVnaW46Wy9DT0xPUl0gW0NPTE9SICVzXSVzWy9DT0xPUl0nICUgKENPTE9SMiwgQ09MT1IxLCBwYXRoKSk7IHdpei5sb2coIltDb21wcm9iYWNpb24gZGUgcnV0YV0gRWwgQURET05fSUQgeSBsYSBjYXJwZXRhIGRlbCBwbHVnaW4gbm8gY29pbmNpZGVuLiAlcyAvICVzICIgJSAoQURET05JRCwgcGF0aCkpCmVsc2U6IHdpei5sb2coIltDb21wcm9iYWNpb24gZGUgcnV0YV0gUGVyZmVjdG8hIiwgeGJtYy5MT0dOT1RJQ0UpCgppZiBLT0RJQURET05TIGluIEFERE9OUEFUSDoKICAgIHdpei5sb2coIkNvcGlhbmRvIHJ1dGEgYWwgZGlyZWN0b3JpbyBkZSBhZGRvbnMiLCB4Ym1jLkxPR05PVElDRSkKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhBRERPTlMpOiBvcy5tYWtlZGlycyhBRERPTlMpCiAgICBuZXdwYXRoID0geGJtYy50cmFuc2xhdGVQYXRoKG9zLnBhdGguam9pbignc3BlY2lhbDovL2hvbWUvYWRkb25zLycsIEFERE9OSUQpKQogICAgaWYgb3MucGF0aC5leGlzdHMobmV3cGF0aCk6CiAgICAgICAgd2l6LmxvZygiTGEgY2FycGV0YSB5YSBleGlzdGlhLCBsaW1waWFuZG8uLi4iLCB4Ym1jLkxPR05PVElDRSkKICAgICAgICB3aXouY2xlYW5Ib3VzZShuZXdwYXRoKQogICAgICAgIHdpei5yZW1vdmVGb2xkZXIobmV3cGF0aCkKICAgIHRyeToKICAgICAgICB3aXouY29weXRyZWUoQURET05QQVRILCBuZXdwYXRoKQogICAgZXhjZXB0IEV4Y2VwdGlvbiwgZToKICAgICAgICBwYXNzCiAgICB3aXouZm9yY2VVcGRhdGUoVHJ1ZSkKCnRyeToKICAgIG15YnVpbGRzID0geGJtYy50cmFuc2xhdGVQYXRoKE1ZQlVJTERTKQogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKG15YnVpbGRzKTogeGJtY3Zmcy5ta2RpcnMobXlidWlsZHMpCmV4Y2VwdDoKICAgIHBhc3MKCndpei5sb2coIltBdXRvIEluc3RhbGFjaW9uIGRlIHJlcG9zaXRvcmlvXSBJbmljaWFkbyIsIHhibWMuTE9HTk9USUNFKQppZiBBVVRPSU5TVEFMTCA9PSAnWWVzJyBhbmQgbm90IG9zLnBhdGguZXhpc3RzKG9zLnBhdGguam9pbihBRERPTlMsIFJFUE9JRCkpOgogICAgd29ya2luZ3htbCA9IHdpei53b3JraW5nVVJMKFJFUE9BRERPTlhNTCkKICAgIGlmIHdvcmtpbmd4bWwgPT0gVHJ1ZToKICAgICAgICB2ZXIgPSB3aXoucGFyc2VET00od2l6Lm9wZW5VUkwoUkVQT0FERE9OWE1MKSwgJ2FkZG9uJywgcmV0PSd2ZXJzaW9uJywgYXR0cnMgPSB7J2lkJzogUkVQT0lEfSkKICAgICAgICBpZiBsZW4odmVyKSA+IDA6CiAgICAgICAgICAgIGluc3RhbGx6aXAgPSAnJXMtJXMuemlwJyAlIChSRVBPSUQsIHZlclswXSkKICAgICAgICAgICAgd29ya2luZ3JlcG8gPSB3aXoud29ya2luZ1VSTChSRVBPWklQVVJMK2luc3RhbGx6aXApCiAgICAgICAgICAgIGlmIHdvcmtpbmdyZXBvID09IFRydWU6CiAgICAgICAgICAgICAgICBEUC5jcmVhdGUoQURET05USVRMRSwnRGVzY2FyZ2FuZG8gcmVwb3NpdG9yaW8uLi4nLCcnLCAnUG9yIGZhdm9yLCBlc3BlcmUuJykKICAgICAgICAgICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhQQUNLQUdFUyk6IG9zLm1ha2VkaXJzKFBBQ0tBR0VTKQogICAgICAgICAgICAgICAgbGliPW9zLnBhdGguam9pbihQQUNLQUdFUywgaW5zdGFsbHppcCkKICAgICAgICAgICAgICAgIHRyeTogb3MucmVtb3ZlKGxpYikKICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICAgICAgZG93bmxvYWRlci5kb3dubG9hZChSRVBPWklQVVJMK2luc3RhbGx6aXAsbGliLCBEUCkKICAgICAgICAgICAgICAgIGV4dHJhY3QuYWxsKGxpYiwgQURET05TLCBEUCkKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBmID0gb3Blbihvcy5wYXRoLmpvaW4oQURET05TLCBSRVBPSUQsICdhZGRvbi54bWwnKSwgbW9kZT0ncicpOyBnID0gZi5yZWFkKCk7IGYuY2xvc2UoKQogICAgICAgICAgICAgICAgICAgIG5hbWUgPSB3aXoucGFyc2VET00oZywgJ2FkZG9uJywgcmV0PSduYW1lJywgYXR0cnMgPSB7J2lkJzogUkVQT0lEfSkKICAgICAgICAgICAgICAgICAgICB3aXouTG9nTm90aWZ5KCJbQ09MT1IgJXNdJXNbL0NPTE9SXSIgJSAoQ09MT1IxLCBuYW1lWzBdKSwgIltDT0xPUiAlc11BZGQtb24gYWN0dWFsaXphZG9bL0NPTE9SXSIgJSBDT0xPUjIsIGljb249b3MucGF0aC5qb2luKEFERE9OUywgUkVQT0lELCAnaWNvbi5wbmcnKSkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICBpZiBLT0RJViA+PSAxNzogd2l6LmFkZG9uRGF0YWJhc2UoUkVQT0lELCAxKQogICAgICAgICAgICAgICAgRFAuY2xvc2UoKQogICAgICAgICAgICAgICAgeGJtYy5zbGVlcCg1MDApCiAgICAgICAgICAgICAgICB3aXouZm9yY2VVcGRhdGUoVHJ1ZSkKICAgICAgICAgICAgICAgIHdpei5sb2coIltBdXRvIEluc3RhbGFjaW9uIGRlIHJlcG9zaXRvcmlvXSBJbnN0YWxhZG8gY29ycmVjdGFtZW50ZSIsIHhibWMuTE9HTk9USUNFKQogICAgICAgICAgICBlbHNlOiAKICAgICAgICAgICAgICAgIHdpei5Mb2dOb3RpZnkoIltDT0xPUiAlc11GYWxsbyBlbiBsYSBpbnN0YWxhY2lvbiBkZWwgcmVwb3NpdG9yaW9bL0NPTE9SXSIgJSBDT0xPUjEsICJbQ09MT1IgJXNdVVJMIG8gWklQIG5vIHZhbGlkb3MhWy9DT0xPUl0iICUgQ09MT1IyKQogICAgICAgICAgICAgICAgd2l6LmxvZygiW0F1dG8gSW5zdGFsYWNpb24gZGUgcmVwb3NpdG9yaW9dIEltcG9zaWJsZSBjcmVhciB1bmEgVVJMIHZhbGlkYSBwYXJhIGVsIHJlcG9zaXRvcmlvLiAlcyIgJSB3b3JraW5ncmVwbywgeGJtYy5MT0dFUlJPUikKICAgICAgICBlbHNlOgogICAgICAgICAgICB3aXoubG9nKCJVUkwgbm8gdmFsaWRhIHBhcmEgZmljaGVybyBaSVAiLCB4Ym1jLkxPR0VSUk9SKQogICAgZWxzZTogCiAgICAgICAgd2l6LkxvZ05vdGlmeSgiW0NPTE9SICVzXUZhbGxvIGVuIGxhIGluc3RhbGFjaW9uIGRlbCByZXBvc2l0b3Jpb1svQ09MT1JdIiAlIENPTE9SMSwgIltDT0xPUiAlc11BcmNoaXZvIGFkZG9uLnhtbCBubyB2YWxpZG8hWy9DT0xPUl0iICUgQ09MT1IyKQogICAgICAgIHdpei5sb2coIltBdXRvIEluc3RhbGFjaW9uIGRlIHJlcG9zaXRvcmlvXSBJbXBvc2libGUgbGVlciBlbCBhcmNoaXZvIGFkZG9uLnhtbC4iLCB4Ym1jLkxPR0VSUk9SKQplbGlmIG5vdCBBVVRPSU5TVEFMTCA9PSAnWWVzJzogd2l6LmxvZygiW0F1dG8gSW5zdGFsYWNpb24gZGUgcmVwb3NpdG9yaW9dIE5vIGFjdGl2YWRvIiwgeGJtYy5MT0dOT1RJQ0UpCmVsaWYgb3MucGF0aC5leGlzdHMob3MucGF0aC5qb2luKEFERE9OUywgUkVQT0lEKSk6IHdpei5sb2coIltBdXRvIEluc3RhbGFjaW9uIGRlIHJlcG9zaXRvcmlvXSBFbCByZXBvc2l0b3JpbyB5YSBlc3RhIGluc3RhbGFkbyIpCgp3aXoubG9nKCJbQXV0byBJbnN0YWxhY2lvbiBkZSBhY3R1YWxpemFjaW9uZXNdIEluaWNpYWRvIiwgeGJtYy5MT0dOT1RJQ0UpCmlmIEFVVE9VUERBVEUgPT0gJ1llcyc6CiAgICB3aXoud2l6YXJkVXBkYXRlKCdzdGFydHVwJykKZWxzZTogd2l6LmxvZygiW0F1dG8gSW5zdGFsYWNpb24gZGUgYWN0dWFsaXphY2lvbmVzXSBObyBhY3RpdmFkbyIsIHhibWMuTE9HTk9USUNFKQoKd2l6LmxvZygiW1NlcnZpY2lvIGRlIE5vdGlmaWNhY2lvbmVzXSBJbmljaWFkbyIsIHhibWMuTE9HTk9USUNFKQppZiBFTkFCTEUgPT0gJ1llcyc6CiAgICBpZiBub3QgTk9USUZZID09ICd0cnVlJzoKICAgICAgICB1cmwgPSB3aXoud29ya2luZ1VSTChOT1RJRklDQVRJT04pCiAgICAgICAgaWYgdXJsID09IFRydWU6CiAgICAgICAgICAgIGlkLCBtc2cgPSB3aXouc3BsaXROb3RpZnkoTk9USUZJQ0FUSU9OKQogICAgICAgICAgICBpZiBub3QgaWQgPT0gRmFsc2U6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaWQgPSBpbnQoaWQpOyBOT1RFSUQgPSBpbnQoTk9URUlEKQogICAgICAgICAgICAgICAgICAgIGlmIGlkID09IE5PVEVJRDoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgTk9URURJU01JU1MgPT0gJ2ZhbHNlJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmeS5ub3RpZmljYXRpb24obXNnKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOiB3aXoubG9nKCJbU2VydmljaW8gZGUgTm90aWZpY2FjaW9uZXNdIGlkWyVzXSBObyBmdW5jaW9uYSIgJSBpbnQoaWQpLCB4Ym1jLkxPR05PVElDRSkKICAgICAgICAgICAgICAgICAgICBlbGlmIGlkID4gTk9URUlEOgogICAgICAgICAgICAgICAgICAgICAgICB3aXoubG9nKCJbU2VydmljaW8gZGUgTm90aWZpY2FjaW9uZXNdIGlkOiAlcyIgJSBzdHIoaWQpLCB4Ym1jLkxPR05PVElDRSkKICAgICAgICAgICAgICAgICAgICAgICAgd2l6LnNldFMoJ25vdGVpZCcsIHN0cihpZCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHdpei5zZXRTKCdub3RlZGlzbWlzcycsICdmYWxzZScpCiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmeS5ub3RpZmljYXRpb24obXNnPW1zZykKICAgICAgICAgICAgICAgICAgICAgICAgd2l6LmxvZygiW1NlcnZpY2lvIGRlIE5vdGlmaWNhY2lvbmVzXSBDb21wbGV0YWRvIiwgeGJtYy5MT0dOT1RJQ0UpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uLCBlOgogICAgICAgICAgICAgICAgICAgIHdpei5sb2coIkVycm9yIGVuIGVsIFNlcnZpY2lvIGRlIE5vdGlmaWNhY2lvbmVzOiAlcyIgJSBzdHIoZSksIHhibWMuTE9HRVJST1IpCiAgICAgICAgICAgIGVsc2U6IHdpei5sb2coIltTZXJ2aWNpbyBkZSBOb3RpZmljYWNpb25lc10gQXJjaGl2byBkZSB0ZXh0byBubyBmb3JtYXRlYWRvIGNvcnJlY3RhbWVudGUiKQogICAgICAgIGVsc2U6IHdpei5sb2coIltTZXJ2aWNpbyBkZSBOb3RpZmljYWNpb25lc10gVVJMKCVzKTogJXMiICUgKE5PVElGSUNBVElPTiwgdXJsKSwgeGJtYy5MT0dOT1RJQ0UpCiAgICBlbHNlOiB3aXoubG9nKCJbU2VydmljaW8gZGUgTm90aWZpY2FjaW9uZXNdIEFwYWdhZG8iLCB4Ym1jLkxPR05PVElDRSkKZWxzZTogd2l6LmxvZygiW1NlcnZpY2lvIGRlIE5vdGlmaWNhY2lvbmVzXSBObyBhY3RpdmFkbyIsIHhibWMuTE9HTk9USUNFKQoKd2l6LmxvZygiW0NvbXByb2JhY2lvbiBkZSB2ZXJzaW9uXSBJbmljaWFkbyIsIHhibWMuTE9HTk9USUNFKQppZiBJTlNUQUxMRUQgPT0gJ3RydWUnOgogICAgaWYgS09ESVYgPj0gMTc6CiAgICAgICAgd2l6LmtvZGkxN0ZpeCgpCiAgICAgICAgaWYgU0tJTiBpbiBbJ3NraW4uY29uZmx1ZW5jZScsICdza2luLmVzdHVhcnknXToKICAgICAgICAgICAgY2hlY2tTa2luKCkKICAgICAgICBGQUlMRUQgPSBUcnVlCiAgICBlbGlmIG5vdCBFWFRSQUNUID09ICcxMDAnIGFuZCBub3QgQlVJTEROQU1FID09ICIiOgogICAgICAgIHdpei5sb2coIltDb21wcm9iYWNpb24gZGUgdmVyc2lvbl0gVmVyc2lvbiBkZXNjb21wcmltaWRhICVzLzEwMCBjb24gW0VSUk9SUzogJXNdIiAlIChFWFRSQUNULCBFWFRFUlJPUiksIHhibWMuTE9HTk9USUNFKQogICAgICAgIHllcz1ESUFMT0cueWVzbm8oQURET05USVRMRSwgJ1tDT0xPUiAlc10lc1svQ09MT1JdIFtDT0xPUiAlc11ubyBpbnN0YWxhZG8gY29ycmVjdGFtZW50ZSEnICUgKENPTE9SMSwgQ09MT1IyLCBCVUlMRE5BTUUpLCAnSW5zdGFsYWRvOiBbQ09MT1IgJXNdJXNbL0NPTE9SXSAvIEVycm9yZXM6IFtDT0xPUiAlc10lc1svQ09MT1JdJyAlIChDT0xPUjEsIEVYVFJBQ1QsIENPTE9SMSwgRVhURVJST1IpLCAnUXVpZXJlcyB2b2x2ZXIgYSBpbnRlbnRhcmxvP1svQ09MT1JdJywgbm9sYWJlbD0nW0JdTm8sIGdyYWNpYXNbL0JdJywgeWVzbGFiZWw9J1tCXVNpWy9CXScpCiAgICAgICAgd2l6LmNsZWFyUygnYnVpbGQnKQogICAgICAgIEZBSUxFRCA9IFRydWUKICAgICAgICBpZiB5ZXM6IAogICAgICAgICAgICB3aXouZWJpKCJQbGF5TWVkaWEocGx1Z2luOi8vJXMvP21vZGU9aW5zdGFsbCZuYW1lPSVzJnVybD1mcmVzaCkiICUgKEFERE9OX0lELCB1cmxsaWIucXVvdGVfcGx1cyhCVUlMRE5BTUUpKSkKICAgICAgICAgICAgd2l6LmxvZygiW0luc3RhbGFjaW9uXSBJbnN0YWxhY2lvbiBsaW1waWEgcmVhY3RpdmFkYSIsIHhibWMuTE9HTk9USUNFKQogICAgICAgIGVsc2U6IHdpei5sb2coIltJbnN0YWxhY2lvbl0gSW5zdGFsYWNpb24gbGltcGlhIGlnbm9yYWRhIikKICAgIGVsaWYgU0tJTiBpbiBbJ3NraW4uY29uZmx1ZW5jZScsICdza2luLmVzdHVhcnknXToKICAgICAgICB3aXoubG9nKCJbSW5zdGFsYWNpb25dIFNraW4gaW5jb3JyZWN0YTogJXMiICUgU0tJTiwgeGJtYy5MT0dOT1RJQ0UpCiAgICAgICAgZGVmYXVsdHMgPSB3aXouZ2V0UygnZGVmYXVsdHNraW4nKQogICAgICAgIGlmIG5vdCBkZWZhdWx0cyA9PSAnJzoKICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMob3MucGF0aC5qb2luKEFERE9OUywgZGVmYXVsdHMpKToKICAgICAgICAgICAgICAgIHNraW5Td2l0Y2guc3dhcFNraW5zKGRlZmF1bHRzKQogICAgICAgICAgICAgICAgeCA9IDAKICAgICAgICAgICAgICAgIHhibWMuc2xlZXAoMTAwMCkKICAgICAgICAgICAgICAgIHdoaWxlIG5vdCB4Ym1jLmdldENvbmRWaXNpYmlsaXR5KCJXaW5kb3cuaXNWaXNpYmxlKHllc25vZGlhbG9nKSIpIGFuZCB4IDwgMTUwOgogICAgICAgICAgICAgICAgICAgIHggKz0gMQogICAgICAgICAgICAgICAgICAgIHhibWMuc2xlZXAoMjAwKQoKICAgICAgICAgICAgICAgIGlmIHhibWMuZ2V0Q29uZFZpc2liaWxpdHkoIldpbmRvdy5pc1Zpc2libGUoeWVzbm9kaWFsb2cpIik6CiAgICAgICAgICAgICAgICAgICAgd2l6LmViaSgnU2VuZENsaWNrKDExKScpCiAgICAgICAgICAgICAgICAgICAgd2l6Lmxvb2thbmRGZWVsRGF0YSgncmVzdG9yZScpCiAgICAgICAgaWYgbm90IHdpei5jdXJyU2tpbigpID09IGRlZmF1bHRzIGFuZCBub3QgQlVJTEROQU1FID09ICIiOgogICAgICAgICAgICBndWkgPSB3aXouY2hlY2tCdWlsZChCVUlMRE5BTUUsICdndWknKQogICAgICAgICAgICBGQUlMRUQgPSBUcnVlCiAgICAgICAgICAgIGlmIGd1aSA9PSAnaHR0cDovLyc6CiAgICAgICAgICAgICAgICB3aXoubG9nKCJbSW5zdGFsYWNpb25dIENvcGlhIGRlIGxhIHNraW4gZW5jb250cmFkYSBlbiBodHRwOi8vIiwgeGJtYy5MT0dOT1RJQ0UpCiAgICAgICAgICAgICAgICBESUFMT0cub2soQURET05USVRMRSwgIltDT0xPUiAlc11QYXJlY2UgcXVlIGxhIHNraW4geSBzdXMgb3BjaW9uZXMgbm8gc2UgaGFuIGluc3RhbGFkbyBjb3JyZWN0YW1lbnRlLiIgJSBDT0xPUjIsICJEZXNhZm9ydHVuYWRhbWVudGUsIGVzdGEgYWN0dWFsaXphY2lvbiBubyBjb250aWVuZSB1bmEgY29waWEgaW5kaXZpZHVhbCBkZSBsYSBza2luIiwgIk5lY2VzaXRhcyByZWluc3RhbGFyIGxhIGFjdHVhbGl6YWNpb24geSBmb3J6YXIgZWwgY2llcnJlIGRlIEtvZGlbL0NPTE9SXSIpCiAgICAgICAgICAgIGVsaWYgd2l6LndvcmtpbmdVUkwoZ3VpKToKICAgICAgICAgICAgICAgIHllcz1ESUFMT0cueWVzbm8oQURET05USVRMRSwgJyVzIG5vIHNlIGhhIGluc3RhbGFkbyBjb3JyZWN0YW1lbnRlIScgJSBCVUlMRE5BTUUsICdQYXJlY2UgcXVlIGxhIHNraW4geSBzdXMgb3BjaW9uZXMgbm8gc2UgaGFuIGluc3RhbGFkbyBjb3JyZWN0YW1lbnRlLicsICdRdWllcmVzIGluc3RhbGFyIGxhIGNvcGlhIGRlIGxhIHNraW4geSBzdXMgb3BjaW9uZXM/Jywgbm9sYWJlbD0nW0JdTm9bL0JdJywgeWVzbGFiZWw9J1tCXVNpLCBwb3IgZmF2b3JbL0JdJykKICAgICAgICAgICAgICAgIGlmIHllczogd2l6LmViaSgiUGxheU1lZGlhKHBsdWdpbjovLyVzLz9tb2RlPWluc3RhbGwmbmFtZT0lcyZ1cmw9Z3VpKSIgJSAoQURET05fSUQsIHVybGxpYi5xdW90ZV9wbHVzKEJVSUxETkFNRSkpKTsgd2l6LmxvZygiW0luc3RhbGFjaW9uXSBJbnRlbnRhbmRvIGluc3RhbGFyIGxhIGNvcGlhIGRlIGxhIHNraW4iKQogICAgICAgICAgICAgICAgZWxzZTogd2l6LmxvZygnW0luc3RhbGFjaW9uXSBDb3BpYSBkZSBsYSBza2luIGVuY29udHJhZGEgeSBmdW5jaW9uYWwgcGVybyBzZSBoYSBjYW5jZWxhZG86ICVzJyAlIGd1aSwgeGJtYy5MT0dOT1RJQ0UpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBESUFMT0cub2soQURET05USVRMRSwgIltDT0xPUiAlc11QYXJlY2UgcXVlIGxhIHNraW4geSBzdXMgb3BjaW9uZXMgbm8gc2UgaGFuIGluc3RhbGFkbyBjb3JyZWN0YW1lbnRlLiIgJSBDT0xPUjIsICJEZXNhZm9ydHVuYWRhbWVudGUsIGVzdGEgYWN0dWFsaXphY2lvbiBubyBjb250aWVuZSB1bmEgY29waWEgaW5kaXZpZHVhbCBkZSBsYSBza2luIiwgIk5lY2VzaXRhcyByZWluc3RhbGFyIGxhIGFjdHVhbGl6YWNpb24geSBmb3J6YXIgZWwgY2llcnJlIGRlIEtvZGlbL0NPTE9SXSIpCiAgICAgICAgICAgICAgICB3aXoubG9nKCdbSW5zdGFsYWNpb25dIENvcGlhIGRlIGxhIHNraW4gbm8gZnVuY2lvbmFsOiAlcycgJSBndWksIHhibWMuTE9HTk9USUNFKQogICAgZWxzZToKICAgICAgICB3aXoubG9nKCdbSW5zdGFsYWNpb25dIFRvZG8gcGFyZWNlIGhhYmVyIGlkbyBjb3JyZWN0YW1lbnRlJywgeGJtYy5MT0dOT1RJQ0UpCiAgICBpZiBub3Qgd2l6LmdldFMoJ3B2cmNsaWVudCcpID09ICIiOgogICAgICAgIHdpei50b2dnbGVBZGRvbih3aXouZ2V0UygncHZyY2xpZW50JyksIDEpCiAgICAgICAgd2l6LmViaSgnU3RhcnRQVlJNYW5hZ2VyJykKICAgIHdpei5hZGRvblVwZGF0ZXMoJ3Jlc2V0JykKICAgIGlmIEtFRVBUUkFLVCA9PSAndHJ1ZSc6IHRyYWt0aXQudHJha3RJdCgncmVzdG9yZScsICdhbGwnKTsgd2l6LmxvZygnW0luc3RhbGFjaW9uXSBSZXN0YXVyYW5kbyBkYXRvcyBkZSBUcmFrdCcsIHhibWMuTE9HTk9USUNFKQogICAgaWYgS0VFUFJFQUwgID09ICd0cnVlJzogZGVicmlkaXQuZGVicmlkSXQoJ3Jlc3RvcmUnLCAnYWxsJyk7IHdpei5sb2coJ1tJbnN0YWxhY2lvbl0gUmVzdGF1cmFuZG8gZGF0b3MgZGUgUmVhbCBEZWJyaWQnLCB4Ym1jLkxPR05PVElDRSkKICAgIGlmIEtFRVBMT0dJTiA9PSAndHJ1ZSc6IGxvZ2luaXQubG9naW5JdCgncmVzdG9yZScsICdhbGwnKTsgd2l6LmxvZygnW0luc3RhbGFjaW9uXSBSZXN0YXVyYW5kbyBkYXRvcyBkZSBMb2dpbicsIHhibWMuTE9HTk9USUNFKQogICAgd2l6LmNsZWFyUygnaW5zdGFsbCcpCmVsc2U6IHdpei5sb2coIkluc3RhbGFjaW9uXSBObyBpbmljaWFkYSIsIHhibWMuTE9HTk9USUNFKQoKaWYgRkFJTEVEID09IEZhbHNlOgogICAgd2l6LmxvZygiW0NvbXByb2JhY2lvbiBkZSB2ZXJzaW9uXSBJbmljaWFkYSIsIHhibWMuTE9HTk9USUNFKQogICAgaWYgbm90IFdPUktJTkc6CiAgICAgICAgd2l6LmxvZygiW0NvbXByb2JhY2lvbiBkZSB2ZXJzaW9uXSBObyBzZSBoYSBlbmNvbnRyYWRvIG5pbmd1bmEgVVJMIHZhbGlkYSBwYXJhIGVzdGEgdmVyc2lvbjogJXMiICUgQlVJTERGSUxFLCB4Ym1jLkxPR05PVElDRSkKICAgIGVsaWYgQlVJTERDSEVDSyA9PSAnJyBhbmQgQlVJTEROQU1FID09ICcnOgogICAgICAgIHdpei5sb2coIltDb21wcm9iYWNpb24gZGUgdmVyc2lvbl0gUHJpbWVyIGluaWNpbyIsIHhibWMuTE9HTk9USUNFKQogICAgICAgIG5vdGlmeS5maXJzdFJ1blNldHRpbmdzKCkKICAgICAgICB4Ym1jLnNsZWVwKDUwMCkKICAgICAgICBub3RpZnkuZmlyc3RSdW4oKQogICAgICAgIHhibWMuc2xlZXAoNTAwKQogICAgICAgIHdpei5zZXRTKCdsYXN0YnVpbGRjaGVjaycsIHN0cihORVhUQ0hFQ0spKQogICAgZWxpZiBub3QgQlVJTEROQU1FID09ICcnOgogICAgICAgIHdpei5sb2coIltDb21wcm9iYWNpb24gZGUgdmVyc2lvbl0gVmVyc2lvbiBpbnN0YWxhZGEiLCB4Ym1jLkxPR05PVElDRSkKICAgICAgICBpZiBTS0lOIGluIFsnc2tpbi5jb25mbHVlbmNlJywgJ3NraW4uZXN0dWFyeSddIGFuZCBub3QgREVGQVVMVElHTk9SRSA9PSAndHJ1ZSc6CiAgICAgICAgICAgIGNoZWNrU2tpbigpCiAgICAgICAgICAgIHdpei5sb2coIltDb21wcm9iYWNpb24gZGUgdmVyc2lvbl0gVmVyc2lvbiBpbnN0YWxhZGE6IENvbXByb2JhbmRvIGFjdHVhbGl6YWNpb25lcyIsIHhibWMuTE9HTk9USUNFKQogICAgICAgICAgICB3aXouc2V0UygnbGFzdGJ1aWxkY2hlY2snLCBzdHIoTkVYVENIRUNLKSkKICAgICAgICAgICAgY2hlY2tVcGRhdGUoKQogICAgICAgIGVsaWYgQlVJTERDSEVDSyA8PSBzdHIoVE9EQVkpOgogICAgICAgICAgICB3aXoubG9nKCJbQ29tcHJvYmFjaW9uIGRlIHZlcnNpb25dIFZlcnNpb24gaW5zdGFsYWRhOiBDb21wcm9iYW5kbyBhY3R1YWxpemFjaW9uZXMiLCB4Ym1jLkxPR05PVElDRSkKICAgICAgICAgICAgd2l6LnNldFMoJ2xhc3RidWlsZGNoZWNrJywgc3RyKE5FWFRDSEVDSykpCiAgICAgICAgICAgIGNoZWNrVXBkYXRlKCkKICAgICAgICBlbHNlOiAKICAgICAgICAgICAgd2l6LmxvZygiW0NvbXByb2JhY2lvbiBkZSB2ZXJzaW9uXSBWZXJzaW9uIGluc3RhbGFkYTogU2lndWllbnRlIGNvbXByb2JhY2lvbiBwcm9ncmFtYWRhIHBhcmE6ICVzIC8gSE9ZIGlzOiAlcyIgJSAoQlVJTERDSEVDSywgc3RyKFRPREFZKSksIHhibWMuTE9HTk9USUNFKQoKd2l6LmxvZygiW0F1dG8gR3VhcmRhZG8gZGUgRGF0b3MgZGUgVHJha3RdIEluaWNpYWRvIiwgeGJtYy5MT0dOT1RJQ0UpCmlmIEtFRVBUUkFLVCA9PSAndHJ1ZSc6CiAgICBpZiBUUkFLVFNBVkUgPD0gc3RyKFRPREFZKToKICAgICAgICB3aXoubG9nKCJbQXV0byBHdWFyZGFkbyBkZSBEYXRvcyBkZSBUcmFrdF0gR3VhcmRhbmRvIHRvZG9zIGxvcyBkYXRvcyIsIHhibWMuTE9HTk9USUNFKQogICAgICAgIHRyYWt0aXQuYXV0b1VwZGF0ZSgnYWxsJykKICAgICAgICB3aXouc2V0UygndHJha3RsYXN0c2F2ZScsIHN0cihUSFJFRURBWVMpKQogICAgZWxzZTogCiAgICAgICAgd2l6LmxvZygiW0F1dG8gR3VhcmRhZG8gZGUgRGF0b3MgZGUgVHJha3RdIFNpZ3VpZW50ZSBhdXRvZ3VhcmRhZG8gcHJvZ3JhbWFkbyBwYXJhOiAlcyAvIEhPWSBlczogJXMiICUgKFRSQUtUU0FWRSwgc3RyKFRPREFZKSksIHhibWMuTE9HTk9USUNFKQplbHNlOiB3aXoubG9nKCJbQXV0byBHdWFyZGFkbyBkZSBEYXRvcyBkZSBUcmFrdF0gTm8gYWN0aXZhZG8iLCB4Ym1jLkxPR05PVElDRSkKCndpei5sb2coIltBdXRvIEd1YXJkYWRvIGRlIERhdG9zIGRlIFJlYWwgRGVicmlkXSBJbmljaWFkbyIsIHhibWMuTE9HTk9USUNFKQppZiBLRUVQUkVBTCA9PSAndHJ1ZSc6CiAgICBpZiBSRUFMU0FWRSA8PSBzdHIoVE9EQVkpOgogICAgICAgIHdpei5sb2coIltBdXRvIEd1YXJkYWRvIGRlIERhdG9zIGRlIFJlYWwgRGVicmlkXSBHdWFyZGFuZG8gdG9kb3MgbG9zIGRhdG9zIiwgeGJtYy5MT0dOT1RJQ0UpCiAgICAgICAgZGVicmlkaXQuYXV0b1VwZGF0ZSgnYWxsJykKICAgICAgICB3aXouc2V0UygnZGVicmlkbGFzdHNhdmUnLCBzdHIoVEhSRUVEQVlTKSkKICAgIGVsc2U6IAogICAgICAgIHdpei5sb2coIltBdXRvIEd1YXJkYWRvIGRlIERhdG9zIGRlIFJlYWwgRGVicmlkXSBTaWd1aWVudGUgYXV0b2d1YXJkYWRvIHByb2dyYW1hZG8gcGFyYTogJXMgLyBIT1kgZXM6ICVzIiAlIChSRUFMU0FWRSwgc3RyKFRPREFZKSksIHhibWMuTE9HTk9USUNFKQplbHNlOiB3aXoubG9nKCJbQXV0byBHdWFyZGFkbyBkZSBEYXRvcyBkZSBSZWFsIERlYnJpZF0gTm8gYWN0aXZhZG8iLCB4Ym1jLkxPR05PVElDRSkKCndpei5sb2coIltBdXRvIEd1YXJkYWRvIGRlIERhdG9zIGRlIExvZ2luXSBJbmljaWFkbyIsIHhibWMuTE9HTk9USUNFKQppZiBLRUVQTE9HSU4gPT0gJ3RydWUnOgogICAgaWYgTE9HSU5TQVZFIDw9IHN0cihUT0RBWSk6CiAgICAgICAgd2l6LmxvZygiW0F1dG8gR3VhcmRhZG8gZGUgRGF0b3MgZGVdIEd1YXJkYW5kbyB0b2RvcyBsb3MgZGF0b3MiLCB4Ym1jLkxPR05PVElDRSkKICAgICAgICBsb2dpbml0LmF1dG9VcGRhdGUoJ2FsbCcpCiAgICAgICAgd2l6LnNldFMoJ2xvZ2lubGFzdHNhdmUnLCBzdHIoVEhSRUVEQVlTKSkKICAgIGVsc2U6IAogICAgICAgIHdpei5sb2coIltBdXRvIEd1YXJkYWRvIGRlIERhdG9zIGRlXSBTaWd1aWVudGUgYXV0b2d1YXJkYWRvIHByb2dyYW1hZG8gcGFyYTogJXMgLyBIT1kgZXM6ICVzIiAlIChMT0dJTlNBVkUsIHN0cihUT0RBWSkpLCB4Ym1jLkxPR05PVElDRSkKZWxzZTogd2l6LmxvZygiW0F1dG8gR3VhcmRhZG8gZGUgRGF0b3MgZGVdIE5vIGFjdGl2YWRvIiwgeGJtYy5MT0dOT1RJQ0UpCgp3aXoubG9nKCJbQXV0byBMaW1waWV6YV0gSW5pY2lhZG8iLCB4Ym1jLkxPR05PVElDRSkKaWYgQVVUT0NMRUFOVVAgPT0gJ3RydWUnOgogICAgc2VydmljZSA9IEZhbHNlCiAgICBkYXlzID0gW1RPREFZLCBUT01PUlJPVywgVEhSRUVEQVlTLCBPTkVXRUVLXQogICAgZmVxID0gaW50KGZsb2F0KEFVVE9GRVEpKQogICAgaWYgQVVUT05FWFRSVU4gPD0gc3RyKFRPREFZKSBvciBmZXEgPT0gMDoKICAgICAgICBzZXJ2aWNlID0gVHJ1ZQogICAgICAgIG5leHRfcnVuID0gZGF5c1tmZXFdCiAgICAgICAgd2l6LnNldFMoJ25leHRhdXRvY2xlYW51cCcsIHN0cihuZXh0X3J1bikpCiAgICBlbHNlOiB3aXoubG9nKCJbQXV0byBMaW1waWV6YV0gUHJveGltYSBsaW1waWV6YSAlcyIgJSBBVVRPTkVYVFJVTiwgeGJtYy5MT0dOT1RJQ0UpCiAgICBpZiBzZXJ2aWNlID09IFRydWU6CiAgICAgICAgQVVUT0NBQ0hFICAgICAgPSB3aXouZ2V0UygnY2xlYXJjYWNoZScpCiAgICAgICAgQVVUT1BBQ0tBR0VTICAgPSB3aXouZ2V0UygnY2xlYXJwYWNrYWdlcycpCiAgICAgICAgQVVUT1RIVU1CUyAgICAgPSB3aXouZ2V0UygnY2xlYXJ0aHVtYnMnKQogICAgICAgIGlmIEFVVE9DQUNIRSA9PSAndHJ1ZSc6IHdpei5sb2coJ1tBdXRvIENsZWFuIFVwXSBDYWNoZTogT24nLCB4Ym1jLkxPR05PVElDRSk7IHdpei5jbGVhckNhY2hlKFRydWUpCiAgICAgICAgZWxzZTogd2l6LmxvZygnW0F1dG8gTGltcGllemFdIENhY2hlOiBPZmYnLCB4Ym1jLkxPR05PVElDRSkKICAgICAgICBpZiBBVVRPVEhVTUJTID09ICd0cnVlJzogd2l6LmxvZygnW0F1dG8gTGltcGllemFdIE1pbmlhdHVyYXMgYW50aWd1YXM6IE9uJywgeGJtYy5MT0dOT1RJQ0UpOyB3aXoub2xkVGh1bWJzKCkKICAgICAgICBlbHNlOiB3aXoubG9nKCdbQXV0byBMaW1waWV6YV0gTWluaWF0dXJhcyBhbnRpZ3VhczogT2ZmJywgeGJtYy5MT0dOT1RJQ0UpCiAgICAgICAgaWYgQVVUT1BBQ0tBR0VTID09ICd0cnVlJzogd2l6LmxvZygnW0F1dG8gTGltcGllemFdIFBhcXVldGVzOiBPbicsIHhibWMuTE9HTk9USUNFKTsgd2l6LmNsZWFyUGFja2FnZXNTdGFydHVwKCkKICAgICAgICBlbHNlOiB3aXoubG9nKCdbQXV0byBMaW1waWV6YV0gUGFxdWV0ZXM6IE9mZicsIHhibWMuTE9HTk9USUNFKQplbHNlOiB3aXoubG9nKCdbQXV0byBMaW1waWV6YV0gQXBhZ2FkYScsIHhibWMuTE9HTk9USUNFKQoKd2l6LnNldFMoJ2tvZGkxN2lzY3JhcCcsICcnKQ=="))
